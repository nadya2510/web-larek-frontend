# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами
-.env - файл с адресом сервера, для работы с данными через API

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Описание проекта

Проект "WEB-ларёк" реализует интернет-магазин с товарами для веб-разработчиков — Web-ларёк. В нём можно посмотреть каталог товаров, добавить товары в корзину и сделать заказ.  Проект реализован на TypeScript и представляет собой SPA (Single Page Application) с использованием API для получения данных о товарах.

Особенности реализации:
— в один момент времени можно бронировать билеты только на один сеанс;
— сеансы обновляются на сервере раз в сутки;
— при использовании заглушки АПИ билеты бронируются на сутки и можно видеть что места заняты;
— до оформления заказа содержимое корзины сохраняется в localStorage;
— после успешного заказа контактные данные сохраняются в localStorage и подставляются в форму заказа в следующий раз.

## Описание интерфейса

Интерфейс можно условно разделить на 3 процесса:
1. Просмотр котолога товара(Page)
2. Просмотр и добавления товара в корзину(Card)
3. Просмотр и редоктирование содержание корзины (Basket)
4. Оформление заказа(Order) 

Так как модальные окна в проекте однотипные, то их общая логика и структура вынесена в абстрактный класс Modal. Все модальные окна наследуются от него и переопределяют методы для своих нужд.

## Структура проекта
```
.
├── src/
│   ├── common.blocks/ [Стили компонент верстки]
│   ├── components/ [Реализация]
│   │   ├── base/ [Базовый код и АПИ]
│   │   ├── common/ [Общие]
│   ├── pages/
│   │   ├── index.html [Основная страница и шаблоны компонент]
│   ├── types/ [Типизация]
│   │   ├── index.ts [Файл с типами]
│   ├── utils/
│   │   ├── constants.ts [Настройки проекта]
│   │   ├── utils.ts [Утилиты для работы с DOM]
├── api.yaml [Спецификация API]
```

## Архитектура проекта (MVP)

Реализована единая модель данных приложения в файле `src/components/AppData.ts`, содержащая всю логику работы с данными и возможные действия над ними. Все изменения данных происходят через методы модели, а она в свою очередь уведомляет об изменениях через метод настроек `emitChange`. Подключение модели к системе событий производится через обертку `src/components/base/events.ts`. 
Работа с API через `src/components/base/api.ts`. 
Управление DOM-элементоами через `src/components/base/Components.ts`.
Базовая модель `src/components/base/Model.ts`. 
Работа с модальными окнами через `src/components/common/Modal.ts`. 
Работа с формами `src/components/common/Form.ts`. 
Презентер `src/components/AppPresenter.ts`
```
``` 
## Базовый код

```
 Класс EventEmitter
``` 
Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков
о наступлении события.
Класс имеет методы:
on — для подписки на событие
off — отписки от события
emit — уведомления подписчиков о наступлении события
onAll — для подписки на все события.
offAll — сброса всех подписчиков.
trigger - генерирующий заданное событие с заданными аргументами. 
Это позволяет передавать его в качестве обработчика события в другие классы. 
Эти классы будут генерировать события, не будучи при этом напрямую зависимыми от
класса  EventEmitter .
```
 Класс  Api
``` 
Реализует работу с API.
Класс имеет методы:
get  — для формирования get запроса к серверу.
post — для формирования post запросов к серверу (параметр data - body запрорса).
```
 Класс  Component
``` 
Реализует управление DOM-элементоами. 
Класс имеет методы:
toggleClass - Переключить класс
addClass - Добавления класса
removeClass - Удаление класса
setText - Установить текстовое содержимое
setDisabled - Сменить статус блокировки
setImage - Установить изображение с алтернативным текстом
render - Вернуть корневой DOM-элемент
```
 Класс  Model
``` 
Базовая модель через метод emitChanges сообщить всем что модель поменялась.
```
 Класс  Modal
``` 
Реализует работу с модальными окнами 
Класс имеет методы:
open - открытие окна, добавление класса для прорисовки, уведомление подписчиков о событии 'modal:open'  
close - закрытие окна, удаление класса для прорисовки, уведомление подписчиков о событии 'modal:close'   
render - возвращает контейнер.
```
 Класс  Form
``` 
Реализует работу с формами. 
Конструктор принимает контейнер и брокер событий
onInputChange - сообщает что изменилось поле ввода input
set errors - устанавливает текст ошибки валидаии
set valid - устанавливает статус блокировки на элементе button с type=submit в соотвествии со статусом валидации
render - возвращает контейнер.
``` 
``` 
## Компоненты модели данных (бизнес-логика)

```
 Класс AppState
``` 
 Модель данных приложения. 
 Класс имеет методы:
 setCatalog - реализует заполнение католога данными, уведомление подписчиков о событии 'items:changed' 
 setPreview - просмотр карточки лота, уведомление подписчиков о событии 'preview:changed' 
 fillOrdere - заполнение массива лотов для оформления заказа 
 getTotal - подсчет итоговой суммы в корзины
 clearBasket - очистки корзины
 setOrderField - заполнение контактной информаии для оформления заказа, в случае успешной валидации, уведомление подписчиков о событии 'order:ready'  
 validateOrder - валидация заполнения форм, уведомление подписчиков о событии 'formOrderErrors:change' /'formContactsErrors:change'
 setStatusCardBasket - смена статуса лота добавлен/ удален из корзины, уведомление подписчиков о событии 'cardStatus:changed' 
 getItemBasket() - список лотов добавленных в коозину
```
Класс Page
``` 
Реализует главную страницу.
Конструктор принимает контейнер и брокер событий для открытия корзины.
Реализует: 
set counter - установка количества лотов на значке корзиины
set catalog - установка католога
```
 Класс Card
``` 
Реализует карточку лота для каталога и для просмотре отдельной карточки. Является наследником базового класса Component.
Конструктор принимает контейнер и брокер событие для кнопки.
Если из списка для просмотра карточки. 
Если из окна просмотра для добавления в корзину.
set title - устанавливает заголовок
set category - устанавливает категорию
set price - устанавливает цену
set image - устанавливает картинку 
set description - устанавливает описание
```
 Класс Basket
``` 
Реализует корзину. Является наследником базового класса Component.
Конструктор принимает контейнер и брокер событий для оформления заказа (уведомление подписчиков о событии 'order:open'). 
items - контейнер для устанока списка лотов
total - итоговая общая сумма лотов
```
 Класс BasketItem
``` 
Реализует список лотов в корзине. Является наследником базового класса Component.
Конструктор принимает контейнер и брокер событий для удаления лота из списка по кнопке (уведомление подписчиков о событии 'card:delBasket').  
set id - устанавливает ИД лота
get id - ИД лота
set index - устанавливает индекс
set title - устанавливает заголовок  
set price - устанавливает цена
```
 Класс Order
``` 
Реализует форму оформления заказа шаг1. 
Является наследником базового класса Form, где происходит проверка заполнения, уведомление подписчиков о событии '/^order\..*:change/'.
Конструктор принимает контейнер и брокер событий для перехода на второй шаг. 
В конструкторе содержится логика для выбора способа оплаты по кнопкам. 
Реализует заполнение:
set address - заполнение адреса
```
 Класс OrderContacts
``` 
Реализует форму оформления заказа шаг2.
Является наследником базового класса Form, где происходит проверка заполнения, уведомление подписчиков о событии '/^contacts\..*:change/'.
Конструктор принимает контейнер и брокер событий для оформления заказа.
Реализует заполнение:
set email - e-mail 
set phone - телефон .

```
 Класс Success
``` 
Реализует форму с информационным сообщением об оформлении заказа с итоговой суммой.
Конструктор принимает контейнер и брокер событий.
set total - установка текста с итоговой суммой.
``` 
``` 

## Интерфейсы

```
Интерфейс приложения
```
interface IAppState {
    catalog: ILot[];//католог
    basket: string[];//корзина
    preview: string | null;//просмотр карточки
    order: IOrder | null;//оформление заказа   
}
```
Интерфейс API web -larek
```
interface IAuctionAPI {
    getLotList: () => Promise<ILot[]>;//получить список лотов
    getLotItem: (id: string) => Promise<ILot>;   //получить информацию по одной лоту по id  
    orderLots: (order: IOrder) => Promise<IOrderResult>; // оформить заказ
}
```
Интерфейс лота
```
interface ILot {
    id: string; //ИД
    description: string; // Описание
    image: string; // Картинка
    title: string;//Заголовок
    category: string;//Категория
    price:number|null;//Цена
    status: LotStatus; //Статус для добавления в карзину 'active' -лот еще не добавлен;  'closed'- лот добавлен в корзину
}
```
Интерфейс карточки лота
```
interface IViewCard {
    title: string; //Заголовок
    category:string;//Категория
    price: number|null;//Цена
    image: string; // Картинка  
    description: string; // Описание
}
interface IViewCardComponent extends IViewCard,IComponent<IViewCard> {}
```
Интерфейс конструкотра карточки лота
```
interface ICardConstructor {
	new (container: HTMLElement, actions?: ICardActions) : IViewCardComponent
}

```
Интерфейс карточки карзины
```
interface IBasketView {   
    items: HTMLElement[]; //Список добавленных лотов
    total: number; // Итоговая сумма   
}

interface IViewBasketComponent extends IViewBasket,IComponent<IViewBasket> {}
```
Интерфейс конструкотра карточки карзины
```
interface IBasketConstructor {
	new (container: HTMLElement, events: IEvents): IViewBasketComponent
}

```
Интерфейс список лотов корзины
```
interface IBasketItem {
    id: string; //ИД
    index: number;// Индекс
    title: string;// Заголовок  
    price: number //Цена
}
interface IViewBasketItemComponent extends IViewBasketItem,IComponent<IViewBasketItem> {}

```
Интерфейс конструкотра списка лотов корзины
```
interface IBasketItemConstructor {
	new (container: HTMLElement, events: IEvents): IViewBasketItemComponent
}
```
Интерфейс оформления заказа Шаг1
```
interface IOrderFormStep1 {
    payment: string;  //способ оплаты 
    address: string;  //адрес  
}
interface IViewOrderFormStep1Component extends IViewOrderFormStep1,IForm<IViewOrderFormStep1> {}
```
Интерфейс конструкотра оформления заказа Шаг1
```
interface IOrderConstructor {
	new (container: HTMLFormElement, events: IEvents): IViewOrderFormStep1Component
}

```
Интерфейс оформления заказа Шаг2
```
 interface IOrderFormStep2 {
    email: string; //e-mail
    phone: string; //телефон   
}
export interface IViewOrderFormStep2Component extends IViewOrderFormStep2,IForm<IViewOrderFormStep2> {}
```
Интерфейс конструкотра оформления заказа Шаг2
```
export interface IContactsConstructor {
	new (container: HTMLFormElement, events: IEvents): IViewOrderFormStep2Component
}
```
Интерфейс оформления заказа
```
 interface IViewOrderForm  extends IViewOrderFormStep1, IViewOrderFormStep2{}
```
Интерфейс оформления заказа для запроса к API
```
interface IOrder  extends IViewOrderForm{ 
    total: number;  //Общая сумма заказа 
    items: string[] //массив id, выбранных лотов 
}
```
Интерфейс ответа запроса к API оформления заказа 
```
interface IOrderResult {
    id: string; //ИД
    total: number; //Итоговая сумма заказа
}
```
``` 
## Презентер AppPresenter

```
Конструктор принимает шаблоны и конструкторы классов бизнес логики.
init - инициализация создание копий шаблонов, запрос и запись данных спика лотов по API;
renderView - прорисовка каталога
previewCard - открыть карту для просмотра;
addBasket - добавить лот в корзину;
openBasket - открыть корзину;
delBasket - удалить лот из корзины;
openОrder - открыть форму оформления заказа шаг1;
orderClick- открыть форму оформления заказа шаг2;
contactsClick- оформить заказ: отправка данных на сервер, обновление страницы;
```
``` 
## События

```
items:changed - Изменились элементы каталога;
card:select - Выбрана карта для просмотра;
preview:changed - Открыта карта для просмотра;
card:addBasket - Лот добавлен в корзину;
basket:open - Открыта корзина;
card:delBasket - Удален лот из корзины;
cardStatus:changed - Изменен статус лота (добавлен / удален из корзины);
order:open - Открыта форма оформления заказа шаг1;
formOrderErrors:change - Изменилось состояние валидации формы оформления заказа шаг1;
/^order\..*:change/ - изменилось одно из полей формы оформления заказа шаг1;
formContactsErrors:change - Изменилось состояние валидации формы оформления заказа шаг2;
/^order\..*:change/ - изменилось одно из полей формы оформления заказа шаг1;
/^contacts\..*:change/ - изменилось одно из полей формы оформления заказа шаг2;
```